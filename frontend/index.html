<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trondheim Historical Map - Explore 300+ Years of History</title>
    <meta name="description" content="Interactive historical map of Trondheim, Norway from 1700 to present. Explore how buildings, roads, and the city evolved over 300 years using data from SEFRAK, Kartverket, and OpenStreetMap.">
    <meta name="keywords" content="Trondheim, historical map, Norway, cartography, OpenStreetMap, Kartverket, time-travel map">
    <meta name="author" content="Trondheim Historical Map Project">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/">
    <meta property="og:title" content="Trondheim Historical Map - Explore 175 Years of History">
    <meta property="og:description" content="Interactive historical map showing the evolution of Trondheim from 1850 to present day.">
    <meta property="og:image" content="https://yourdomain.com/preview.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://yourdomain.com/">
    <meta property="twitter:title" content="Trondheim Historical Map">
    <meta property="twitter:description" content="Explore 175 years of Trondheim's history through interactive maps">
    <meta property="twitter:image" content="https://yourdomain.com/preview.jpg">

    <!-- MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@4.0.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@4.0.0/dist/maplibre-gl.css" rel="stylesheet" />

    <!-- PMTiles Protocol -->
    <script src="https://unpkg.com/pmtiles@3.0.6/dist/pmtiles.js"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="map"></div>

    <!-- Controls Panel -->
    <div class="controls-container">
        <!-- Compact Header with Year + Slider -->
        <div class="controls-header-compact">
            <h1>Trondheim Historical Map</h1>
            <div class="year-slider-row">
                <span class="year-value" id="currentYear">2020</span>
                <button id="stepBackBtn" class="step-btn" aria-label="Step back one year" title="Step back">‚óÄ</button>
                <button id="playBtn" class="play-btn" aria-label="Play timeline animation" title="Play timeline">‚ñ∂</button>
                <button id="stepFwdBtn" class="step-btn" aria-label="Step forward one year" title="Step forward">‚ñ∂</button>
                <input
                    type="range"
                    id="yearSlider"
                    min="1700"
                    max="2025"
                    value="2020"
                    step="1"
                    class="year-slider"
                    aria-label="Select year"
                />
            </div>
        </div>

        <!-- Minimal Layer Toggles -->
        <div class="layer-toggles">
            <button id="toggleBackground" class="layer-toggle active" title="Toggle background layers">
                <span class="toggle-icon">üó∫Ô∏è</span>
                <span class="toggle-label">Background</span>
            </button>
            <button id="toggleDebug" class="layer-toggle" title="Debug: Show date sources">
                <span class="toggle-icon">üîç</span>
                <span class="toggle-label">Debug</span>
            </button>
            <button id="toggleEdit" class="layer-toggle" title="Edit mode">
                <span class="toggle-icon">‚úèÔ∏è</span>
                <span class="toggle-label">Edit</span>
            </button>
        </div>

        <!-- Hidden source checkboxes (for JS compatibility) -->
        <div style="display:none;">
            <input type="checkbox" id="src-sef" checked data-date-source="sef">
            <input type="checkbox" id="src-mat" checked data-date-source="mat">
            <input type="checkbox" id="src-tk" checked data-date-source="tk">
            <input type="checkbox" id="src-man" checked data-date-source="man">
            <input type="checkbox" id="src-finn" checked data-date-source="finn">
            <input type="checkbox" id="src-osm" checked data-date-source="osm">
            <input type="checkbox" id="snap-kv1880" checked data-snapshot-source="kv1880">
            <input type="checkbox" id="snap-kv1904" data-snapshot-source="kv1904">
            <input type="checkbox" id="snap-air1947" data-snapshot-source="air1947">
            <input type="checkbox" id="road-src-nvdb" checked data-road-source="nvdb">
            <input type="checkbox" id="road-src-kult" checked data-road-source="kult">
            <input type="checkbox" id="road-src-osm" checked data-road-source="osm">
            <input type="checkbox" id="road-src-ml_kv1880" checked data-road-source="ml_kv1880">
            <input type="checkbox" id="road-src-ml_kv1904" checked data-road-source="ml_kv1904">
            <input type="checkbox" id="road-src-ml_air1947" checked data-road-source="ml_air1947">
            <input type="checkbox" id="toggle-water" checked data-layer="water">
            <input type="checkbox" id="toggle-landuse" checked data-layer="landuse">
            <input type="checkbox" id="toggle-labels" checked data-layer="labels">
        </div>

        <!-- Compact Footer -->
        <div class="controls-footer">
            <a href="about.html" class="about-link-mini">About</a>
            <span class="data-credit">¬© OSM | SEFRAK | Kartverket</span>
        </div>
    </div>

    <!-- Debug Legend (shown when debug mode active) -->
    <div id="debugLegend" class="debug-legend" style="display: none;">
        <div class="debug-legend-title">Date Sources</div>
        <div class="debug-legend-section">
            <div class="debug-legend-subtitle">Direct Sources</div>
            <div class="debug-legend-item"><span class="legend-color" style="background:#3498db"></span>FINN.no</div>
            <div class="debug-legend-item"><span class="legend-color" style="background:#8b4513"></span>SEFRAK</div>
            <div class="debug-legend-item"><span class="legend-color" style="background:#2ecc71"></span>Manual</div>
            <div class="debug-legend-item"><span class="legend-color" style="background:#9b59b6"></span>TK</div>
            <div class="debug-legend-item"><span class="legend-color" style="background:#1abc9c"></span>Matrikkelen</div>
        </div>
        <div class="debug-legend-section">
            <div class="debug-legend-subtitle">Inherited</div>
            <div class="debug-legend-item"><span class="legend-color" style="background:#f1c40f"></span>Median (2km)</div>
            <div class="debug-legend-item"><span class="legend-color" style="background:#e67e22"></span>Nearest</div>
            <div class="debug-legend-item"><span class="legend-color" style="background:#e74c3c"></span>Fallback</div>
        </div>
        <div class="debug-legend-section">
            <div class="debug-legend-item"><span class="legend-color" style="background:#95a5a6"></span>Unknown</div>
        </div>
    </div>

    <!-- Source Inspection Mode Selector (small button) -->
    <div class="inspection-selector-mini">
        <button id="inspectMlBtn" class="inspect-ml-btn" title="Inspect ML detections">
            üîç ML
        </button>
        <div class="inspection-dropdown" id="inspectionDropdown">
            <div class="inspection-buttons">
                <span class="inspection-loading">Loading...</span>
            </div>
        </div>
    </div>

    <!-- Source Inspection Mode Overlay (shown when active) -->
    <div id="inspectionOverlay" class="inspection-overlay">
        <div class="inspection-header">
            <h2>Source Inspection</h2>
            <button class="inspection-close" onclick="exitInspectionMode()">&times;</button>
        </div>
        <div class="inspection-content">
            <div class="inspection-source">
                <span class="label">Viewing:</span>
                <span id="inspectionSourceName" class="source-name">-</span>
            </div>

            <div id="inspectionStats" class="inspection-stats">
                <div class="stat-row">
                    <span class="stat-label">Buildings:</span>
                    <span class="stat-value">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Roads:</span>
                    <span class="stat-value">-</span>
                </div>
            </div>

            <div class="confidence-legend">
                <h4>Confidence</h4>
                <div class="confidence-scale">
                    <span class="conf-low">0%</span>
                    <div class="conf-gradient"></div>
                    <span class="conf-high">100%</span>
                </div>
                <div class="conf-labels">
                    <span style="color: #ff0000;">Low</span>
                    <span style="color: #ffaa00;">Med</span>
                    <span style="color: #00ff00;">High</span>
                </div>
            </div>

            <div class="inspection-controls">
                <label class="opacity-control">
                    <span>Map Opacity:</span>
                    <input type="range" id="historicalMapOpacity" min="0" max="100" value="70"
                           onchange="updateHistoricalMapOpacity(this.value)">
                </label>
            </div>
        </div>
    </div>

    <!-- Loading indicator -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading map...</p>
    </div>

    <!-- Error message -->
    <div id="error" class="error-message" style="display: none;">
        <p id="errorText"></p>
    </div>

    <script src="app.js"></script>
</body>
</html>
